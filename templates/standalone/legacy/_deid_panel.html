{% set root = request.scope.get('root_path', '') if request and request.scope else '' %}
{% set deid_options = deid_templates if deid_templates is defined and deid_templates else [] %}
{% set default_deid_template = 'default' if 'default' in deid_options else (deid_options[0] if deid_options else '') %}
<section id="deid-panel" class="interop-panel interop-panel-deid panel collapsed">
  <div class="module-body" data-acc-body>
    <h3 class="text-h3 mb">De-identify</h3>
    <form id="deid-form"
          method="post" autocomplete="off" novalidate
          action="{{ root }}/standalone/api/deidentify"
          hx-post="{{ root }}/standalone/api/deidentify"
          hx-encoding="application/x-www-form-urlencoded"
          hx-target="#deid-output"
          hx-swap="textContent"
          hx-headers='{"Accept":"text/plain"}'>
      <input type="hidden" name="message" id="deid-message-from-gen">
      <div class="field">
        <label>Template</label>
        <select name="template_name">
          {% for t in deid_options %}
          <option value="{{t}}" {% if t == default_deid_template %}selected{% endif %}>{{t}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="actions">
        <button type="submit">Run De-identify</button>
      </div>
    </form>
    <pre id="deid-output" class="mono"></pre>
  </div>
</section>
