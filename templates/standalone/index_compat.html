<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Standalone Pipeline</title>
    <link rel="stylesheet" href="{{ request.url_for('static', path='standalone/legacy.css') }}">
    <link rel="stylesheet" href="{{ request.url_for('static', path='standalone/interop_extras.css') }}">
    <link rel="stylesheet" href="{{ request.url_for('static', path='standalone/standalone_1006.css') }}">
    <script src="{{ request.url_for('static', path='standalone/hl7_ui.js') }}" defer></script>
    <script src="{{ request.url_for('static', path='standalone/interop_standalone.js') }}" defer></script>
    <script>
      window.STANDALONE_PIPELINE_URLS = {{ urls | tojson }};
    </script>
  </head>
  <body class="standalone">
    <main class="container legacy-interop-skin" data-skin="1006">
      {% include "standalone/legacy/_pipe_bridge.html" %}
      <section class="run-card">
        <h2>Standalone Pipeline</h2>
        <p class="subtle">Generate → De-identify → Validate</p>
      </section>
      <div class="cards-stack">
        {% include "standalone/legacy/_generate_panel.html" %}
        {% include "standalone/legacy/_deid_panel.html" %}
        {% include "standalone/legacy/_validate_panel.html" %}
        {% include "standalone/legacy/_mllp_panel.html" ignore missing %}
      </div>
    </main>
    <script>
      (function () {
        const bridge = window.SilhouettePipeBridge;
        if (bridge && typeof bridge.mirror === 'function') {
          bridge.mirror('#std-version', '#pipe-version');
          bridge.mirror('#std-trigger-input', '#pipe-trigger-typed');
          bridge.mirror('#deid-msg', '#pipe-text');
          bridge.mirror('#validate-msg', '#pipe-text');
        }
        document.addEventListener('htmx:afterSwap', function (event) {
          const target = event.detail && event.detail.target;
          if (!target || !target.id) {
            return;
          }
          if (target.id === 'gen-output' || target.id === 'deid-output' || target.id === 'validate-output') {
            const hidden = document.getElementById('pipe-text');
            if (hidden) {
              hidden.value = (target.textContent || '').trim();
            }
          }
        });
      })();
    </script>
  </body>
  </html>
