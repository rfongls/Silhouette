{% set stage = stage or '' %}
<div class="action-tray" data-source="{{ source_selector|default('#gen-output') }}" data-stage="{{ stage }}">
  <div class="action-tray-header">
    <h4>Next steps</h4>
    <p class="muted small">Choose what to do with this message.</p>
  </div>
  <div class="action-cards">
    {% if stage in ('gen', 'deid') %}
      {% if stage == 'gen' %}
      <button class="action-card" type="button" data-action="deid" title="Open De-identify with this message">
        <strong>ğŸ”’ De-identify</strong><small>Apply de-id rules.</small>
      </button>
      {% endif %}
      <button class="action-card" type="button" data-action="validate" title="Open Validate with this message">
        <strong>âœ“ Validate</strong><small>Ensure structural correctness.</small>
      </button>
    {% elif stage == 'validate' %}
      <button class="action-card" type="button" data-action="mllp" title="Send message via MLLP">
        <strong>ğŸ“¤ Send via MLLP</strong><small>Deliver and view ACK.</small>
      </button>
      <button class="action-card" type="button" data-action="pipeline" title="Run HL7 â†’ FHIR">
        <strong>ğŸ”„ HL7 â†’ FHIR</strong><small>Translate &amp; validate.</small>
      </button>
    {% elif stage == 'pipeline' %}
      <button class="action-card" type="button" data-action="mllp" title="Send message via MLLP">
        <strong>ğŸ“¤ Send via MLLP</strong><small>Deliver and view ACK.</small>
      </button>
    {% endif %}
  </div>
</div>
