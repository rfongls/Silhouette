<details id="deid-panel" class="card collapsible" open>
  <summary>ðŸ”’ De-identify <span class="minimax"></span></summary>
  <div class="module-body">
    <form id="deid-form"
          hx-post="{{ urls.api_deidentify }}"
          hx-encoding="multipart/form-data"
          hx-target="#deid-output"
          hx-swap="textContent"
          hx-headers='{"Accept":"text/plain"}'>
      <label class="text-caption muted" for="deid-msg">HL7 Message (paste)</label>
      <textarea class="codepane limit10" name="message" id="deid-msg" rows="8" placeholder="MSH|^~\&amp;|..."></textarea>

      <div class="row gap small mt" role="group" aria-label="De-identify options">
        <label class="text-caption muted" for="deid-template" style="min-width:10rem;">Template</label>
        <input class="input" name="deid_template" id="deid-template" placeholder="template id (optional)" list="std-deid-templates" />
        <span class="text-caption muted">or upload .hl7</span>
        <input class="input" type="file" name="file" accept=".hl7,.txt" />
        <button class="btn" type="submit">Run De-identify</button>
      </div>
    </form>

    <datalist id="std-deid-templates">
      {% for template in deid_templates %}
        <option value="{{ template }}"></option>
      {% endfor %}
    </datalist>

    <label class="text-caption muted mt" for="deid-output">Output</label>
    <pre id="deid-output" class="codepane limit10" aria-live="polite"></pre>

    <details class="card collapsible" id="deid-report-panel">
      <summary>
        <div class="summary-title">Processed errors</div>
        <div class="summary-meta"><span class="minimax"></span></div>
      </summary>
      <div class="module-body">
        <form id="deid-report-form"
              hx-post="{{ urls.api_deidentify_summary }}"
              hx-target="#deid-report"
              hx-swap="innerHTML"
              hx-headers='{"Accept":"text/html"}'>
          <input type="hidden" name="text" id="deid-report-text" />
          <input type="hidden" name="after_text" id="deid-report-after" />
          <input type="hidden" name="deid_template" id="deid-report-template" />
          <div class="row gap small">
            <button type="button" class="btn btn-sm" data-role="deid-report-refresh">Refresh report</button>
            <button type="button" class="btn btn-sm" data-role="deid-report-clear">Clear</button>
            <span class="micro muted">Coverage updates as soon as the module runs.</span>
          </div>
        </form>
        <div id="deid-report" class="codepane limit10" aria-live="polite"></div>
      </div>
    </details>

    {% with source_selector = '#deid-output' %}
      {% include "ui/standalone/partials/_action_tray.html" %}
    {% endwith %}
  </div>
</details>
