<details id="deid-panel" class="card collapsible">
  <summary>
    <div class="summary-title">ðŸ”’ De-identify</div>
    <div class="summary-meta"><span class="minimax"></span></div>
  </summary>
  <div class="module-body">
    <form id="deid-form" role="form"
          hx-post="{{ urls.api_deidentify }}"
          hx-encoding="multipart/form-data"
          hx-target="#deid-output"
          hx-swap="textContent"
          hx-headers='{"Accept":"text/plain"}'>
      <label class="text-caption muted" for="deid-msg">HL7 Message (paste)</label>
      <textarea class="codepane limit10" name="message" id="deid-msg" rows="8" placeholder="MSH|^~\&amp;|..."></textarea>

      <div class="row gap small mt" role="group" aria-label="De-identify options">
        <label class="text-caption muted" for="deid-template" style="min-width:10rem;">Template</label>
        <select class="input" name="deid_template" id="deid-template"
                placeholder="template id (optional)"
                hx-get="{{ urls.ui_deid_templates }}" hx-trigger="load"
                hx-target="#deid-template" hx-swap="innerHTML">
          <option value="">â€” choose a rule â€”</option>
          {% for template in deid_templates %}
            <option value="{{ template }}">{{ template }}</option>
          {% endfor %}
        </select>
        <span class="text-caption muted">templates in configs/interop/deid_templates/</span>
        <span class="text-caption muted">or upload .hl7</span>
        <input class="input" type="file" name="file" accept=".hl7,.txt" />
        <button class="btn" type="submit">Run De-identify</button>
      </div>
    </form>

    <label class="text-caption muted mt" for="deid-output">Output</label>
    <pre id="deid-output" class="codepane limit10" aria-live="polite"></pre>

    <details class="card collapsible" id="deid-report-panel">
      <summary>
        <div class="summary-title">Processed errors</div>
        <div class="summary-meta"><span class="minimax"></span></div>
      </summary>
      <div class="module-body">
        <div class="toolbar">
          <button class="chip" type="button" data-role="deid-filter" data-k="status" data-v="pass" aria-pressed="false">Pass</button>
          <button class="chip" type="button" data-role="deid-filter" data-k="status" data-v="fail" aria-pressed="false">Fail</button>
          <input class="input" name="segment" id="deid-filter-seg" placeholder="SEG (e.g., PID-5)" style="min-width:10rem;" />
          <input class="input" name="action" id="deid-filter-action" placeholder="action (redact|mask|hash)" />
          <input class="input" name="parameter" id="deid-filter-param" placeholder="parameter" />
          <button class="btn btn-sm" type="button" data-role="deid-report-refresh">Filter</button>
          <button class="btn btn-sm" type="button" data-role="deid-report-clear">Reset</button>
        </div>
        <form id="deid-report-form" role="form"
              hx-post="{{ urls.api_deidentify_summary }}"
              hx-target="#deid-report"
              hx-swap="innerHTML"
              hx-headers='{"Accept":"text/html"}'>
          <input type="hidden" name="text" id="deid-report-text" />
          <input type="hidden" name="after_text" id="deid-report-after" />
          <input type="hidden" name="deid_template" id="deid-report-template" />
          <input type="hidden" name="segment" id="deid-report-seg" />
          <input type="hidden" name="action" id="deid-report-action" />
          <input type="hidden" name="parameter" id="deid-report-parameter" />
          <input type="hidden" name="status" id="deid-report-status" />
        </form>
        <div id="deid-report" class="codepane limit10" aria-live="polite"></div>
      </div>
    </details>

    {% with source_selector = '#deid-output', stage='deid' %}{% include "ui/standalone/partials/_action_tray.html" %}{% endwith %}
  </div>
</details>
