{% set root = request.scope.get('root_path', '') %}
<section id="validate-panel" class="interop-panel interop-panel-validate">
  <form id="val-form"
        method="post"
        action="{{ urls.ui_validate | default(root ~ '/ui/interop/validate', true) }}"
        hx-post="{{ urls.api_validate | default(root ~ '/api/interop/validate', true) }}"
        hx-target="#validate-output"
        hx-swap="innerHTML"
        hx-on::afterSwap="window.InteropUI.onValidateComplete(event)">
    <textarea class="input textarea-output" id="val-text" name="text" placeholder="Paste HL7 to validate"></textarea>
    <div class="row gap mt">
      <input class="input" type="text" name="profile" placeholder="profile/workbook (optional)" />
      <button class="btn" type="submit" data-action="validate">Validate</button>
    </div>
  </form>
  <div id="validate-output" class="scrollbox codepane mt small muted"></div>

  <div id="validate-run-tray" class="action-tray mt" hidden>
    <div class="action-tray-header">
      <h4>Validation finished</h4>
      <p>Continue the pipeline or fix and reâ€‘validate.</p>
    </div>
    <div class="action-cards">
      <button class="action-card" type="button" data-action="revalidate"
              onclick="const ta=document.getElementById('val-text'); if(ta){ta.focus(); ta.scrollIntoView({behavior:'smooth', block:'center'});}">
        <strong>â†» Edit &amp; Reâ€‘Run</strong><small>Apply fixes and validate again.</small>
      </button>
      <a class="action-card" href="{{ root }}/ui/interop/pipeline#mllp-panel" data-action="next-mllp">
        <strong>ðŸ“¤ Send via MLLP</strong><small>Deliver and view ACK.</small>
      </a>
      <a class="action-card" href="{{ root }}/ui/interop/pipeline#translate-panel" data-action="next-fhir">
        <strong>ðŸ”„ HL7 â†’ FHIR</strong><small>Translate the validated message.</small>
      </a>
    </div>
  </div>
</section>
