{% set root = request.scope.get('root_path', '') %}
<section id="mllp-panel" class="interop-panel interop-panel-mllp">
  <form id="mllp-form"
        method="post"
        hx-post="{{ root }}/api/interop/mllp/send"
        hx-target="#mllp-output"
        hx-swap="innerHTML"
        hx-on::afterSwap="window.InteropUI.onMllpComplete(event)">
    <div class="row gap">
      <input class="input" id="mllp-host" name="host" type="text" placeholder="host" value="127.0.0.1" />
      <input class="input" id="mllp-port" name="port" type="number" placeholder="port" value="2575" />
      <input class="input" id="mllp-timeout" name="timeout" type="number" step="0.1" placeholder="timeout (s)" value="5" />
    </div>
    <div class="row gap mt">
      <label><input type="checkbox" id="run-pipeline-fhir" name="also_fhir" /> Also translate to FHIR</label>
      <input class="input grow" id="fhir-endpoint" name="fhir_endpoint" placeholder="https://example.org/fhir (optional)" />
      <label class="small"><input type="checkbox" id="run-pipeline-fhir-post" name="post_fhir" /> POST FHIR bundle</label>
    </div>
    <textarea class="input textarea-output mt" id="mllp-messages" name="messages" placeholder="Paste one or more HL7 messagesâ€¦"></textarea>
    <div class="row gap mt">
      <input id="mllp-file" type="file" accept=".hl7,.txt" />
      <button class="btn" type="button" onclick="window.InteropUI.loadFileIntoTextarea('mllp-file','mllp-messages')">Load file</button>
      <span class="small muted">Blank line separates multiple messages.</span>
    </div>
    <div class="row gap mt">
      <button class="btn" type="submit" data-action="mllp-send">Send (MLLP)</button>
    </div>
  </form>
  <div id="mllp-output" class="scrollbox codepane mt small muted"></div>

  <div id="mllp-run-tray" class="action-tray mt" hidden>
    <div class="action-tray-header">
      <h4>Transport complete</h4>
      <p>Decide how to follow up after delivery.</p>
    </div>
    <div class="action-cards">
      <a class="action-card" href="#" onclick="window.InteropUI.openPipelineFrom('mllp'); return false;">
        <strong>ðŸ”„ HL7 â†’ FHIR Pipeline</strong>
        <small>Reuse this payload for analytics or APIs.</small>
      </a>
      <a class="action-card" href="#" onclick="const ta=document.getElementById('mllp-messages'); if(ta){ta.focus();} return false;">
        <strong>â†» Re-send</strong>
        <small>Adjust the payload or destination and try again.</small>
      </a>
      <a class="action-card" href="{{ root }}/reports">
        <strong>ðŸ“Š View reports</strong>
        <small>Check ACK codes and latency trends.</small>
      </a>
    </div>
  </div>
</section>
