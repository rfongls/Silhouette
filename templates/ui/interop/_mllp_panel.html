{% set root = request.scope.get('root_path', '') %}
<section id="mllp-panel" class="panel interop-panel interop-panel-mllp">
  <form id="mllp-form"
        method="post"
        hx-post="{{ root }}/api/interop/mllp/send"
        hx-target="#mllp-output"
        hx-swap="innerHTML"
        hx-on::afterSwap="window.InteropUI.onMllpComplete(event)">
    <div class="row gap">
      <input class="input" id="mllp-host" name="host" type="text" placeholder="host" value="127.0.0.1" />
      <input class="input" id="mllp-port" name="port" type="number" placeholder="port" value="2575" />
      <input class="input" id="mllp-timeout" name="timeout" type="number" step="0.1" placeholder="timeout (s)" value="5" />
    </div>
    <div class="row gap mt">
      <label><input type="checkbox" id="run-pipeline-fhir" name="also_fhir" /> Also translate to FHIR</label>
      <input class="input grow" id="fhir-endpoint" name="fhir_endpoint" placeholder="https://example.org/fhir (optional)" />
      <label class="small"><input type="checkbox" id="run-pipeline-fhir-post" name="post_fhir" /> POST FHIR bundle</label>
    </div>
    <textarea class="input textarea-output mt" id="mllp-messages" name="messages" placeholder="Paste one or more HL7 messagesâ€¦"></textarea>
    <div class="row gap mt">
      <input id="mllp-file" type="file" accept=".hl7,.txt" />
      <button class="btn" type="button" onclick="window.InteropUI.loadFileIntoTextarea('mllp-file','mllp-messages')">Load file</button>
      <span class="small muted">Blank line separates multiple messages.</span>
    </div>
    <div class="row gap mt">
      <button class="btn" type="submit" data-action="mllp-send">Send (MLLP)</button>
    </div>
  </form>
  <div id="mllp-output" class="scrollbox codepane mt small muted"></div>

  <div id="mllp-run-tray" class="action-tray mt" hidden>
    <div class="action-tray-header">
      <h4>Transport complete</h4>
      <p>Followâ€‘up actions.</p>
    </div>
    <div class="action-cards">
      <button class="action-card" type="button" data-run-to="mllp">
        <strong>â†» Reâ€‘Send</strong>
        <small>Try another destination.</small>
      </button>
      <button class="action-card" type="button" data-run-to="translate">
        <strong>ðŸ”„ HL7 â†’ FHIR</strong>
        <small>Translate for analytics.</small>
      </button>
      <a class="action-card" href="{{ link_for(request, 'ui_reports_acks', '/reports/acks') }}">
        <strong>ðŸ“Š View Reports</strong><small>ACK codes &amp; latency; search by MSHâ€‘10.</small>
      </a>
    </div>
  </div>
</section>
