<section class="deid-coverage">
  <details open class="card" style="padding:0.75rem">
    <summary class="text-h4" style="cursor:pointer">
      De-identification report
    </summary>
    {% set _rows = (r.rows or r.data or []) %}
    {% set _total = r.total_messages or r.msg_total or r.total or 0 %}
    {% if _rows and _rows|length > 0 %}
      <p class="text-small muted" style="margin:.5rem 0 .75rem">
        Coverage across {{ _total }} message{{ '' if _total == 1 else 's' }}.
      </p>
      <div class="scrollbox">
        <table style="width:100%;border-collapse:collapse;font-size:.9rem">
          <thead>
            <tr style="text-align:left;border-bottom:1px solid var(--color-border, #2b3345)">
              <th style="padding:.5rem">Segment</th>
              <th style="padding:.5rem">Field</th>
              <th style="padding:.5rem">Comp</th>
              <th style="padding:.5rem">Subcomp</th>
              <th style="padding:.5rem">Action</th>
              <th style="padding:.5rem">Logic</th>
              <th style="padding:.5rem">Total Messages</th>
            </tr>
          </thead>
          <tbody>
            {% for it in _rows %}
              <tr style="border-bottom:1px solid var(--color-border, #2b3345)">
                <td style="padding:.5rem"><code class="mono">{{ it.segment or '—' }}</code></td>
                <td style="padding:.5rem"><code class="mono">{{ it.field if it.field is not none else '—' }}</code></td>
                <td style="padding:.5rem"><code class="mono">{{ it.component if it.component is not none else '—' }}</code></td>
                <td style="padding:.5rem"><code class="mono">{{ it.subcomponent if it.subcomponent is not none else '—' }}</code></td>
                <td style="padding:.5rem">{{ it.action or '—' }}</td>
                <td style="padding:.5rem">{{ it.logic or '—' }}</td>
                <td style="padding:.5rem">{{ it.applied | default(0) }}/{{ _total }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted" style="margin-top:.75rem">Run de-identify to see coverage by rule.</p>
    {% endif %}
  </details>
</section>
