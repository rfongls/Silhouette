<section class="card">
  <h3>Generate Messages</h3>
  <form id="gen-form"
        hx-post="/api/interop/generate"
        hx-encoding="json"
        hx-trigger="submit"
        hx-target="#gen-output"
        hx-swap="innerHTML">
    <div class="row gap">
      <label>Version</label>
      <select name="version" class="input hl7-version-select" id="gen-version" data-hx-refresh-target="1">
        <option value="hl7-v2-3">HL7 v2.3</option>
        <option value="hl7-v2-4" selected>HL7 v2.4</option>
        <option value="hl7-v2-5">HL7 v2.5</option>
      </select>

      <select class="input" id="gen-trigger-select"
              hx-get="/ui/interop/triggers"
              hx-vals='{"version": document.getElementById("gen-version").value}'
              hx-target="#gen-trigger-select"
              hx-trigger="load, change from:#gen-version"
              onchange="window.InteropUI.syncTyped('gen')">
      </select>

      <input class="input grow" type="text" name="template_relpath" list="gen-trigger-datalist"
             placeholder="e.g., hl7-v2-4/ADT_A01.hl7"/>
      <datalist id="gen-trigger-datalist"></datalist>

      <input class="input" type="number" name="count" min="1" max="10000" value="25" />
      <input class="input" type="number" name="seed" placeholder="seed (optional)"/>
    </div>

    <div class="row gap mt">
      <label><input type="checkbox" name="ensure_unique" checked/> Unique IDs</label>
      <label><input type="checkbox" name="include_clinical"/> Enrich clinical (DG1/AL1)</label>
      <label><input type="checkbox" name="deidentify"/> De-identify</label>
      <select class="input" name="output_format">
        <option value="single" selected>single .hl7 (concatenated)</option>
        <option value="ndjson">NDJSON</option>
        <option value="zip">ZIP (one per file)</option>
      </select>
    </div>

    <div class="row gap mt">
      <button class="btn" onclick="this.form.count.value=1; return true;">Preview 1</button>
      <button class="btn" onclick="this.form.count.value=Math.max(1, parseInt(this.form.count.value||'1')); return true;">Generate</button>
    </div>
  </form>
  <pre id="gen-output" class="codepane muted mt">Use Sample Finder to copy a template relpath, pick a trigger, or type and select. Then Generate.</pre>
</section>
