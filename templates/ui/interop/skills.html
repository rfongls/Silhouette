{% extends "layout.html" %}
{% block extra_head %}
<link rel="stylesheet" href="{{ request.url_for('static', path='css/interop_extras.css') }}" />
<script type="module" src="{{ request.url_for('static', path='js/interop_ui.js') }}"></script>
{% endblock %}

{% block extra_scripts %}
<script src="{{ request.url_for('static', path='js/validate_panel.js') }}" defer></script>
{% endblock %}
{% block content %}
{% if urls is not defined %}
  {% set urls = {} %}
{% endif %}
{% set root = request.scope.get('root_path', '') %}
<div class="row mb" style="justify-content: space-between; align-items: center;">
  <h2>Interoperability</h2>
  <span id="debug-state-badge"
        hx-get="{{ request.url_for('api_diag_debug_state') }}?format=html"
        hx-trigger="load"
        hx-target="this"
        hx-swap="outerHTML">
    <span class="micro muted">Loading debug switchâ€¦</span>
  </span>
</div>
<nav class="module-nav" id="interop-feature-bar">
  <button class="module-btn active" type="button" data-feature="gen" data-panel="generate-panel"
          aria-controls="generate-panel" aria-expanded="true">âš¡ Generate</button>
  <button class="module-btn" type="button" data-feature="deid" data-panel="deid-panel"
          aria-controls="deid-panel" aria-expanded="false">ðŸ”’ Deâ€‘identify</button>
  <button class="module-btn" type="button" data-feature="val" data-panel="validate-panel"
          aria-controls="validate-panel" aria-expanded="false">âœ“ Validate</button>
  <button class="module-btn" type="button" data-feature="mllp" data-panel="mllp-panel"
          aria-controls="mllp-panel" aria-expanded="false">ðŸ“¤ MLLP Send</button>
  <a class="module-btn" data-feature="pipe" href="{{ root }}/ui/interop/pipeline">â†’ Full Pipeline</a>
</nav>

<details id="card-gen" class="card collapsible interop-card-generate" open>
  <summary>Generate Messages <span class="minimax"></span></summary>
  <div class="card-body">
    {% include "ui/interop/_generate_panel.html" %}
  </div>
</details>

<details id="card-deid" class="card collapsible interop-card-deid">
  <summary>Deâ€‘Identify Message <span class="minimax"></span></summary>
  <div class="card-body">
    {% include "ui/interop/_deid_panel.html" %}
  </div>
</details>

<details id="card-validate" class="card collapsible interop-card-validate">
  <summary>Validate Message <span class="minimax"></span></summary>
  <div class="card-body">
    {% include "ui/interop/_validate_panel.html" %}
  </div>
</details>

<details id="card-mllp" class="card collapsible interop-card-mllp">
  <summary>Transport (MLLP) &amp; FHIR Options <span class="minimax"></span></summary>
  <div class="card-body">
    {% include "ui/interop/_mllp_panel.html" %}
  </div>
</details>

<details id="card-debug" class="card collapsible">
  <summary>Generator Debug Log <span class="minimax"></span></summary>
  <div class="card-body">
    {% include "ui/interop/_debug_log_panel.html" %}
  </div>
</details>
{% endblock %}
