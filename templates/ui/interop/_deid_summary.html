<section class="card">
  <header class="row wrap" style="justify-content:space-between;align-items:center">
    <h4 class="text-h4" style="margin:0">De‑identified fields</h4>
    <input class="input small" placeholder="Filter by logic (e.g. NAME, PHONE)"
           oninput="(function(v){document.querySelectorAll('#deid-summary tbody tr').forEach(function(row){var logic=(row.dataset.logic||'').toLowerCase();row.hidden=!!v && !logic.includes(v);});})(this.value.trim().toLowerCase())">
  </header>

  <div id="deid-summary" class="mt">
    {% for group in groups or [] %}
      <details open class="mt">
        <summary class="text-h5">{{ group.segment or '—' }} <span class="muted small">({{ group.count }})</span></summary>
        <div class="scrollbox" style="margin-top:0.5rem">
          <table class="table small">
            <thead>
              <tr>
                <th style="padding:0.5rem">Field</th>
                <th style="padding:0.5rem">Comp</th>
                <th style="padding:0.5rem">Subcomp</th>
                <th style="padding:0.5rem">Before</th>
                <th style="padding:0.5rem">After</th>
                <th style="padding:0.5rem">Logic</th>
              </tr>
            </thead>
            <tbody>
            {% for row in group.items %}
              <tr data-logic="{{ (row.logic or '') | lower }}">
                <td style="padding:0.5rem"><code class="mono">{{ row.field if row.field is not none else '—' }}</code></td>
                <td style="padding:0.5rem"><code class="mono">{{ row.component if row.component is not none else '—' }}</code></td>
                <td style="padding:0.5rem"><code class="mono">{{ row.subcomponent if row.subcomponent is not none else '—' }}</code></td>
                <td style="padding:0.5rem"><code class="mono">{{ row.before or '' }}</code></td>
                <td style="padding:0.5rem"><code class="mono">{{ row.after or '' }}</code></td>
                <td style="padding:0.5rem"><code class="mono">{{ row.logic or '—' }}</code></td>
              </tr>
            {% else %}
              <tr><td colspan="6" class="muted" style="padding:0.5rem">No changes in this segment.</td></tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </details>
    {% else %}
      <p class="muted" style="margin-top:1rem">No de-identifiable fields changed.</p>
    {% endfor %}
  </div>
</section>
