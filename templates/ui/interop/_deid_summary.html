<section class="deid-coverage">
  <header class="row wrap" style="align-items:center;justify-content:space-between;gap:.5rem">
    <h4 class="text-h3" style="margin:0">De‑identified fields</h4>
    <span class="muted small">Based on {{ total_messages }} message{{ 's' if (total_messages or 0) != 1 else '' }}.</span>
  </header>

  {% for group in groups or [] %}
    <details class="mt" open>
      <summary class="text-h4">{{ group.segment or '—' }} <span class="muted small">({{ group.count }})</span></summary>
      <div class="scrollbox mt small">
        <table style="width:100%;border-collapse:collapse">
          <thead>
            <tr style="text-align:left;border-bottom:1px solid var(--color-border,#2a3348)">
              <th style="padding:.5rem">Field</th>
              <th style="padding:.5rem">Comp</th>
              <th style="padding:.5rem">Subcomp</th>
              <th style="padding:.5rem">Logic</th>
              <th style="padding:.5rem">% Applied</th>
            </tr>
          </thead>
          <tbody>
          {% for row in group.items %}
            <tr style="border-bottom:1px solid var(--color-border,#1d2538)">
              <td style="padding:.5rem">{{ row.field if row.field is not none else '—' }}</td>
              <td style="padding:.5rem">{{ row.component if row.component is not none else '—' }}</td>
              <td style="padding:.5rem">{{ row.subcomponent if row.subcomponent is not none else '—' }}</td>
              <td style="padding:.5rem">{{ row.logic or '—' }}</td>
              <td style="padding:.5rem">{{ row.pct }}%</td>
            </tr>
          {% else %}
            <tr><td colspan="5" class="muted" style="padding:.75rem">No configured targets for this segment.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </details>
  {% else %}
    <p class="muted" style="margin-top:1rem">Run de-identify to see coverage.</p>
  {% endfor %}
</section>
