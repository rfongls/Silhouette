{% set root = request.scope.get('root_path', '') %}
<form id="deid-form"
      method="post"
      hx-post="{{ root }}/api/interop/deidentify"
      hx-headers='{"Accept":"application/json"}'
      hx-target="#deid-report"
      hx-swap="none"
      hx-on::afterRequest="window.InteropUI.onDeidResponse(event)">
  <textarea id="deid-text" name="text" class="input textarea-output" placeholder="Paste HL7 to de-identify"></textarea>
  <div class="row gap mt">
    <input class="input" id="deid-seed" name="seed" placeholder="seed (optional)" />
    <button id="deid-run" class="btn" type="submit">De‑identify</button>
  </div>
</form>
<details id="deid-mini-report" class="mini-report" open>
  <summary>Change report</summary>
  <div id="deid-report" class="small muted">Awaiting result…</div>
</details>
<div class="action-tray mt">
  <div class="action-card" onclick="window.InteropUI.runNextFromDeid('validate')">
    <strong>Run Next Pipeline → Validate</strong>
    <small>Use the de‑identified HL7 for validation.</small>
  </div>
  <div class="action-card" onclick="window.InteropUI.runNextFromDeid('mllp')">
    <strong>Run MLLP Pipeline</strong>
    <small>Prefill the MLLP card with the de‑identified message.</small>
  </div>
  <div class="action-card" onclick="window.InteropUI.runTo('fhir')">
    <strong>Run Full FHIR Pipeline → HL7 → FHIR</strong>
    <small>Open the transport card with FHIR translation enabled.</small>
  </div>
</div>
