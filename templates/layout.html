<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Silhouette UI</title>
  <meta name="root-path" content="{{ request.scope.get('root_path', '') }}" />
  <meta name="app-root" content="{{ request.scope.get('root_path', '') }}" />
  <link rel="stylesheet" href="{{ request.url_for('static', path='css/app.css') }}" />
  <link rel="stylesheet" href="{{ request.url_for('static', path='css/dashboard.css') }}" />
  {% block extra_head %}{% endblock %}
  <script src="{{ request.url_for('static', path='htmx.min.js') }}"></script>
  <script type="module" src="{{ request.url_for('static', path='js/examples.js') }}"></script>
</head>
<body data-root="{{ request.scope.get('root_path', '') }}">
  {% set root = request.scope.get('root_path', '') %}
  {% set current_path = request.url.path if request.url else '' %}
  {% set home_url = request.url_for('ui_home') %}
  {% set skills_url = request.url_for('ui_skills_index') %}
  {% set home_path = root ~ '/ui/home' %}
  {% set skills_path = root ~ '/ui/skills' %}
  {% set interop_path = root ~ '/ui/interop' %}
  {% set interop_url = root ~ '/ui/interop/skills' %}
  {% set reports_path = root ~ '/reports' %}

  <header class="top-nav">
    <div class="nav-container">
      <div class="nav-brand">
        <a class="brand-text" href="{{ home_url }}">Silhouette</a>
      </div>
      <nav class="nav-main">
        <a href="{{ home_url }}" class="nav-link {% if current_path.startswith(home_path) %}active{% endif %}">Home</a>
        <a href="{{ skills_url }}" class="nav-link {% if current_path.startswith(skills_path) %}active{% endif %}">Skills</a>
        <a href="{{ interop_url }}" class="nav-link {% if current_path.startswith(interop_path) %}active{% endif %}">Interoperability</a>
        <a href="{{ reports_path }}" class="nav-link {% if current_path.startswith(reports_path) %}active{% endif %}">Reports</a>
      </nav>
      <div class="nav-actions">
        <button class="hamburger-btn" id="hamburger-toggle"
                onclick="window.SilhouetteMenuToggle && window.SilhouetteMenuToggle()"
                aria-label="Open settings" aria-expanded="false">
          <span class="hamburger-icon" aria-hidden="true"></span>
        </button>
      </div>
    </div>
  </header>

  <div class="overlay" id="overlay"></div>
  <div class="hamburger-menu" id="hamburger-menu" aria-hidden="true">
    <div class="hamburger-content">
      <div class="hamburger-header">
        <h3>Settings</h3>
        <button class="close-hamburger" id="close-hamburger" aria-label="Close settings">Ã—</button>
      </div>
      <div class="menu-section">
        <h4>Theme</h4>
        <div class="theme-selector">
          <label class="theme-option">
            <input type="radio" name="theme" value="light" checked />
            <span class="theme-label">Light</span>
          </label>
          <label class="theme-option">
            <input type="radio" name="theme" value="dark" />
            <span class="theme-label">Dark</span>
          </label>
          <label class="theme-option">
            <input type="radio" name="theme" value="high-contrast" />
            <span class="theme-label">High Contrast</span>
          </label>
          <label class="theme-option">
            <input type="radio" name="theme" value="professional" />
            <span class="theme-label">Professional</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <main>
    {% block content %}{% endblock %}
  </main>

  <script>
  // --- Minimal KPI refresher (no-HTMX fallback) ---
  (function(){
    function refreshKPI(sel, url){
      var el = document.querySelector(sel);
      if (!el) return;
      try {
        fetch(url, { cache: "no-cache" })
          .then(function(r){ return r.text(); })
          .then(function(html){ el.innerHTML = html; })
          .catch(function(){ /* silent */ });
      } catch(e) { /* silent */ }
    }
    // Expose globally so partials can call it after actions
    window.refreshKPI = refreshKPI;

    var ROOT = {{ request.scope.get('root_path', '') | tojson }};
    try { window.ROOT = ROOT; } catch (e) { /* ignore */ }
    function withRoot(path){
      if (!path) return ROOT;
      return ROOT + path;
    }

    document.addEventListener('DOMContentLoaded', function(){
      // Security KPI
      if (document.querySelector('#kpi-wrap')) {
        refreshKPI('#kpi-wrap', withRoot('/security/summary'));
        setInterval(function(){ refreshKPI('#kpi-wrap', withRoot('/security/summary')); }, 10000);
      }
    });
  })();
  </script>
  <script src="{{ request.url_for('static', path='js/nav.js') }}" defer></script>
  <script src="{{ request.url_for('static', path='js/pipeline_bus.js') }}" defer></script>
  <script src="{{ request.url_for('static', path='js/pipeline_tray.js') }}" defer></script>
  {% block extra_scripts %}{% endblock %}
</body>
</html>
