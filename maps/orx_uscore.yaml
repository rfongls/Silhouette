messageTypes:
  # Observation result and specimen-oriented messages similar to ORU^R01
  - "ORF^R02"
  - "ORF^R04"
  - "OUL^R21"
  - "OUL^R22"
#
# These message types carry observation results and specimen information.
# We reuse the ORU^R01 mapping to create DiagnosticReport, Observation,
# Specimen, Condition, AllergyIntolerance and Procedure resources where
# applicable.
resourcePlan:
  - resource: Patient
    profile: "http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"
    rules:
      - hl7_path: "PID.3[*]"
        fhir_path: "identifier[]"
        transform: "pid3_to_identifiers"
      - hl7_path: "PID.5[0]"
        fhir_path: "name[0]"
        transform: "name_family_given"
      - hl7_path: "PID.7"
        fhir_path: "birthDate"
        transform: "ts_to_date"
      - hl7_path: "PID.8"
        fhir_path: "gender"
        transform: "sex_to_gender"
  - resource: DiagnosticReport
    profile: "http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab"
    rules:
      - hl7_path: "-"
        fhir_path: "status"
        transform: "default_dr_status"
      - hl7_path: "OBR.4"
        fhir_path: "code"
        transform: "obx_cwe_to_codeableconcept"
      - hl7_path: "OBR.7"
        fhir_path: "effectiveDateTime"
        transform: "ts_to_datetime"
      - hl7_path: "OBR.25"
        fhir_path: "status"
        transform: "obr_status_to_report_status"
  - resource: Observation
    profile: "http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-lab"
    rules:
      - hl7_path: "-"
        fhir_path: "category[0]"
        transform: "obs_category_laboratory"
      - hl7_path: "OBX.3"
        fhir_path: "code"
        transform: "obx_cwe_to_codeableconcept"
      - hl7_path: "OBX.2|OBX.5|OBX.6|OBX.3"
        fhir_path: "value[x]"
        transform: "obx_value_to_valuex"
      - hl7_path: "OBX.11"
        fhir_path: "status"
        transform: "obx_status_to_obs_status"
  - resource: Specimen
    profile: "http://hl7.org/fhir/StructureDefinition/Specimen"
    rules:
      - hl7_path: "SPM.2"
        fhir_path: "id"
      - hl7_path: "SPM.4"
        fhir_path: "type"
        transform: "spm_cwe_to_codeableconcept"
  - resource: Condition
    profile: "http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition"
    rules:
      - hl7_path: "DG1.3"
        fhir_path: "code"
        transform: "dg1_to_codeableconcept"
      - hl7_path: "DG1.5"
        fhir_path: "onsetDateTime"
        transform: "ts_to_datetime"
      - hl7_path: "PID.3"
        fhir_path: "subject.identifier"
        transform: "cx_to_identifier"
      - hl7_path: "-"
        fhir_path: "clinicalStatus"
        transform: "default_condition_clinical_status"
      - hl7_path: "-"
        fhir_path: "verificationStatus"
        transform: "default_condition_verification_status"
  - resource: AllergyIntolerance
    profile: "http://hl7.org/fhir/us/core/StructureDefinition/us-core-allergyintolerance"
    rules:
      - hl7_path: "AL1.3"
        fhir_path: "code"
        transform: "al1_to_codeableconcept"
      - hl7_path: "AL1.6"
        fhir_path: "onsetDateTime"
        transform: "ts_to_datetime"
      - hl7_path: "PID.3"
        fhir_path: "patient.identifier"
        transform: "cx_to_identifier"
      - hl7_path: "AL1.6"
        fhir_path: "reaction[0].manifestation[0].text"
      - hl7_path: "-"
        fhir_path: "clinicalStatus"
        transform: "default_allergy_clinical_status"
      - hl7_path: "-"
        fhir_path: "verificationStatus"
        transform: "default_allergy_verification_status"
  - resource: Procedure
    profile: "http://hl7.org/fhir/us/core/StructureDefinition/us-core-procedure"
    rules:
      - hl7_path: "PR1.3"
        fhir_path: "code"
        transform: "obx_cwe_to_codeableconcept"
      - hl7_path: "PR1.5"
        fhir_path: "performedDateTime"
        transform: "ts_to_datetime"
      - hl7_path: "PID.3"
        fhir_path: "subject.identifier"
        transform: "cx_to_identifier"
      - hl7_path: "-"
        fhir_path: "status"
        transform: "default_procedure_status"